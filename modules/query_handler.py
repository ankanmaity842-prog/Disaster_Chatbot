from .language_support import translate_input, translate_output

def handle_query(user_input, user_lang='en'):
    """
    Handle user queries and return appropriate disaster response
    """
    # First translate input to English if needed
    translated_input = translate_input(user_input, user_lang)
    user_input_processed = translated_input.lower()
    
    # Disaster response database
    responses = {
        'earthquake': {
            'en': "ЁЯЪи EARTHQUAKE SAFETY:\nтАв Drop, Cover, and Hold On immediately\nтАв Stay away from windows and heavy objects\nтАв If outdoors, move away from buildings\nтАв Check for injuries after shaking stops\nтАв Be prepared for aftershocks",
            'hi': "ЁЯЪи рднреВрдХрдВрдк рд╕реБрд░рдХреНрд╖рд╛:\nтАв рддреБрд░рдВрдд рдЭреБрдХреЗрдВ, рдЫреБрдкреЗрдВ рдФрд░ рдкрдХрдбрд╝реЗрдВ\nтАв рдЦрд┐рдбрд╝рдХрд┐рдпреЛрдВ рдФрд░ рднрд╛рд░реА рд╡рд╕реНрддреБрдУрдВ рд╕реЗ рджреВрд░ рд░рд╣реЗрдВ\nтАв рдпрджрд┐ рдмрд╛рд╣рд░ рд╣реИрдВ рддреЛ рднрд╡рдиреЛрдВ рд╕реЗ рджреВрд░ рдЪрд▓реЗ рдЬрд╛рдПрдВ\nтАв рд╣рд┐рд▓рдирд╛ рдмрдВрдж рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЪреЛрдЯреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ\nтАв рдмрд╛рдж рдХреЗ рдЭрдЯрдХреЛрдВ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд░рд╣реЗрдВ",
            'bn': "ЁЯЪи ржнрзВржорж┐ржХржорзНржк рж╕рзБрж░ржХрзНрж╖рж╛:\nтАв ржЕржмрж┐рж▓ржорзНржмрзЗ ржирж┐ржЪрзЗ ржирзЗржорзЗ ржЖрж╢рзНрж░ржпрж╝ ржирж┐ржи\nтАв ржЬрж╛ржирж╛рж▓рж╛ ржПржмржВ ржнрж╛рж░рзА ржмрж╕рзНрждрзБ ржерзЗржХрзЗ ржжрзВрж░рзЗ ржерж╛ржХрзБржи\nтАв ржмрж╛ржЗрж░рзЗ ржерж╛ржХрж▓рзЗ ржнржмржи ржерзЗржХрзЗ ржжрзВрж░рзЗ рж╕рж░рзЗ ржпрж╛ржи\nтАв ржХржорзНржкржи ржмржирзНржз рж╣ржУржпрж╝рж╛рж░ ржкрж░ ржЖржШрж╛рждрзЗрж░ ржЬржирзНржп ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи\nтАв ржкрж░ржмрж░рзНрждрзА ржЭрж╛ржБржХрзБржирж┐рж░ ржЬржирзНржп ржкрзНрж░рж╕рзНрждрзБржд ржерж╛ржХрзБржи"
        },
        'flood': {
            'en': "ЁЯМК FLOOD SAFETY:\nтАв Move to higher ground immediately\nтАв Avoid walking/driving through flood water\nтАв Stay away from downed power lines\nтАв Listen to emergency broadcasts\nтАв Have emergency supplies ready",
            'hi': "ЁЯМК рдмрд╛рдврд╝ рд╕реБрд░рдХреНрд╖рд╛:\nтАв рддреБрд░рдВрдд рдКрдВрдЪреА рдЬрдЧрд╣ рдкрд░ рдЪрд▓реЗ рдЬрд╛рдПрдВ\nтАв рдмрд╛рдврд╝ рдХреЗ рдкрд╛рдиреА рдореЗрдВ рдЪрд▓рдиреЗ/рдЧрд╛рдбрд╝реА рдЪрд▓рд╛рдиреЗ рд╕реЗ рдмрдЪреЗрдВ\nтАв рдЧрд┐рд░реА рд╣реБрдИ рдмрд┐рдЬрд▓реА рдХреА рддрд╛рд░реЛрдВ рд╕реЗ рджреВрд░ рд░рд╣реЗрдВ\nтАв рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдкреНрд░рд╕рд╛рд░рдг рд╕реБрдиреЗрдВ\nтАв рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдЖрдкреВрд░реНрддрд┐ рддреИрдпрд╛рд░ рд░рдЦреЗрдВ",
            'bn': "ЁЯМК ржмржирзНржпрж╛ рж╕рзБрж░ржХрзНрж╖рж╛:\nтАв ржЕржмрж┐рж▓ржорзНржмрзЗ ржЙржБржЪрзБ ржЬржорж┐рждрзЗ ржЪрж▓рзЗ ржпрж╛ржи\nтАв ржмржирзНржпрж╛рж░ ржкрж╛ржирж┐рждрзЗ рж╣рж╛ржБржЯрж╛/ржЧрж╛ржбрж╝рж┐ ржЪрж╛рж▓рж╛ржирзЛ ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи\nтАв ржкржбрж╝рзЗ ржпрж╛ржУржпрж╝рж╛ ржмрж┐ржжрзНржпрзБрзО рж▓рж╛ржЗржи ржерзЗржХрзЗ ржжрзВрж░рзЗ ржерж╛ржХрзБржи\nтАв ржЬрж░рзБрж░рзА рж╕ржорзНржкрзНрж░ржЪрж╛рж░ рж╢рзБржирзБржи\nтАв ржЬрж░рзБрж░рзА рж╕рж░ржмрж░рж╛рж╣ ржкрзНрж░рж╕рзНрждрзБржд рж░рж╛ржЦрзБржи"
        },
        'fire': {
            'en': "ЁЯФе FIRE SAFETY:\nтАв Call emergency services immediately (112)\nтАв Get low and crawl under smoke\nтАв Feel doors before opening them\nтАв Have an escape plan and meeting point\nтАв Never use elevators during a fire",
            'hi': "ЁЯФе рдЖрдЧ рдХреА рд╕реБрд░рдХреНрд╖рд╛:\nтАв рддреБрд░рдВрдд рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ (112)\nтАв рдиреАрдЪреЗ рдЭреБрдХреЗрдВ рдФрд░ рдзреБрдПрдВ рдХреЗ рдиреАрдЪреЗ рд░реЗрдВрдЧреЗрдВ\nтАв рджрд░рд╡рд╛рдЬреЗ рдЦреЛрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЙрдиреНрд╣реЗрдВ рдЫреВрдХрд░ рджреЗрдЦреЗрдВ\nтАв рдмрдЪрдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдФрд░ рдорд┐рд▓рдиреЗ рдХрд╛ рд╕реНрдерд╛рди рд░рдЦреЗрдВ\nтАв рдЖрдЧ рдХреЗ рджреМрд░рд╛рди рд▓рд┐рдлреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ",
            'bn': "ЁЯФе ржЕржЧрзНржирж┐ рж╕рзБрж░ржХрзНрж╖рж╛:\nтАв ржЕржмрж┐рж▓ржорзНржмрзЗ ржЬрж░рзБрж░рзА ржкрж░рж┐рж╖рзЗржмрж╛ржпрж╝ ржХрж▓ ржХрж░рзБржи (112)\nтАв ржирж┐ржЪрзЗ ржирзЗржорзЗ ржзрзЛржБржпрж╝рж╛рж░ ржирж┐ржЪрзЗ рж╣рж╛ржорж╛ржЧрзБржбрж╝рж┐ ржжрж┐ржи\nтАв ржжрж░ржЬрж╛ ржЦрзЛрж▓рж╛рж░ ржЖржЧрзЗ рж╕рзНржкрж░рзНрж╢ ржХрж░рзЗ ржжрзЗржЦрзБржи\nтАв ржкрж╛рж▓рж╛ржирзЛрж░ ржкрж░рж┐ржХрж▓рзНржкржирж╛ ржПржмржВ ржорж┐рж▓ржирж╕рзНржерж▓ рж░рж╛ржЦрзБржи\nтАв ржЖржЧрзБржирзЗрж░ рж╕ржоржпрж╝ рж▓рж┐ржлржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи ржирж╛"
        },
        'cyclone': {
            'en': "ЁЯМкя╕П CYCLONE SAFETY:\nтАв Stay indoors and away from windows\nтАв Stock up on emergency supplies\nтАв Charge all electronic devices\nтАв Listen to weather updates regularly\nтАв Secure outdoor items",
            'hi': "ЁЯМкя╕П рдЪрдХреНрд░рд╡рд╛рдд рд╕реБрд░рдХреНрд╖рд╛:\nтАв рдШрд░ рдХреЗ рдЕрдВрджрд░ рд░рд╣реЗрдВ рдФрд░ рдЦрд┐рдбрд╝рдХрд┐рдпреЛрдВ рд╕реЗ рджреВрд░ рд░рд╣реЗрдВ\nтАв рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдЖрдкреВрд░реНрддрд┐ рдХрд╛ рднрдВрдбрд╛рд░ рдХрд░реЗрдВ\nтАв рд╕рднреА рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХ рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдЪрд╛рд░реНрдЬ рдХрд░реЗрдВ\nтАв рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдореМрд╕рдо рдЕрдкрдбреЗрдЯ рд╕реБрдиреЗрдВ\nтАв рдмрд╛рд╣рд░реА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдВ",
            'bn': "ЁЯМкя╕П ржШрзВрж░рзНржгрж┐ржЭржбрж╝ рж╕рзБрж░ржХрзНрж╖рж╛:\nтАв ржШрж░рзЗрж░ ржнрж┐рждрж░рзЗ ржерж╛ржХрзБржи ржПржмржВ ржЬрж╛ржирж╛рж▓рж╛ ржерзЗржХрзЗ ржжрзВрж░рзЗ ржерж╛ржХрзБржи\nтАв ржЬрж░рзБрж░рзА рж╕рж░ржмрж░рж╛рж╣рзЗрж░ ржоржЬрзБржж ржХрж░рзБржи\nтАв рж╕ржорж╕рзНржд ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХ ржбрж┐ржнрж╛ржЗрж╕ ржЪрж╛рж░рзНржЬ ржХрж░рзБржи\nтАв ржирж┐ржпрж╝ржорж┐ржд ржЖржмрж╣рж╛ржУржпрж╝рж╛ ржЖржкржбрзЗржЯ рж╢рзБржирзБржи\nтАв ржмрж╛ржЗрж░рзЗрж░ ржЬрж┐ржирж┐рж╕ржкрждрзНрж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рзБржи"
        }
    }
    
    # Check for specific disaster types
    for disaster_type, disaster_responses in responses.items():
        if disaster_type in user_input_processed or any(keyword in user_input.lower() for keyword in [
            'рднреВрдХрдВрдк', 'ржнрзВржорж┐ржХржорзНржк', 'роиро┐ро▓роироЯрпБроХрпНроХроорпН' if disaster_type == 'earthquake' else '',
            'рдмрд╛рдврд╝', 'ржмржирзНржпрж╛', 'ро╡рпЖро│рпНро│роорпН' if disaster_type == 'flood' else '',
            'рдЖрдЧ', 'ржЕржЧрзНржирж┐', 'родрпА' if disaster_type == 'fire' else '',
            'рдЪрдХреНрд░рд╡рд╛рдд', 'ржШрзВрж░рзНржгрж┐ржЭржбрж╝', 'роЪрпВро▒ро╛ро╡ро│ро┐' if disaster_type == 'cyclone' else ''
        ]):
            return disaster_responses.get(user_lang, disaster_responses['en'])
    
    # General help responses
    general_responses = {
        'en': "ЁЯдЦ DisastraBot Help:\nтАв Ask me about: earthquake, flood, fire, cyclone safety\nтАв I support multiple languages\nтАв For immediate emergencies, call 112\nтАв Type specific disaster names for detailed safety tips",
        'hi': "ЁЯдЦ DisastraBot рд╕рд╣рд╛рдпрддрд╛:\nтАв рдореБрдЭрд╕реЗ рдкреВрдЫреЗрдВ: рднреВрдХрдВрдк, рдмрд╛рдврд╝, рдЖрдЧ, рдЪрдХреНрд░рд╡рд╛рдд рд╕реБрд░рдХреНрд╖рд╛\nтАв рдореИрдВ рдХрдИ рднрд╛рд╖рд╛рдУрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реВрдВ\nтАв рддрддреНрдХрд╛рд▓ рдЖрдкрд╛рддрдХрд╛рд▓ рдХреЗ рд▓рд┐рдП 112 рдкрд░ рдХреЙрд▓ рдХрд░реЗрдВ\nтАв рд╡рд┐рд╕реНрддреГрдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдЭрд╛рд╡реЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрдкрджрд╛ рдирд╛рдо рдЯрд╛рдЗрдк рдХрд░реЗрдВ",
        'bn': "ЁЯдЦ DisastraBot рж╕рж╣рж╛ржпрж╝рждрж╛:\nтАв ржЖржорж╛ржХрзЗ ржЬрж┐ржЬрзНржЮрж╛рж╕рж╛ ржХрж░рзБржи: ржнрзВржорж┐ржХржорзНржк, ржмржирзНржпрж╛, ржЕржЧрзНржирж┐, ржШрзВрж░рзНржгрж┐ржЭржбрж╝ рж╕рзБрж░ржХрзНрж╖рж╛\nтАв ржЖржорж┐ ржПржХрж╛ржзрж┐ржХ ржнрж╛рж╖рж╛ рж╕ржорж░рзНржержи ржХрж░рж┐\nтАв рждрж╛рзОржХрзНрж╖ржгрж┐ржХ ржЬрж░рзБрж░рзА ржЕржмрж╕рзНржерж╛рж░ ржЬржирзНржп 112 ржХрж▓ ржХрж░рзБржи\nтАв ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржЯрж┐ржкрж╕рзЗрж░ ржЬржирзНржп ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржжрзБрж░рзНржпрзЛржЧрзЗрж░ ржирж╛ржо ржЯрж╛ржЗржк ржХрж░рзБржи"
    }
    
    # Check for help keywords
    help_keywords = ['help', 'рдорджрдж', 'рж╕рж╛рж╣рж╛ржпрзНржп', 'safety', 'рд╕реБрд░рдХреНрд╖рд╛', 'ржирж┐рж░рж╛ржкрждрзНрждрж╛', 'what', 'рдХреИрд╕реЗ', 'ржХрж┐ржнрж╛ржмрзЗ']
    if any(keyword in user_input_processed for keyword in help_keywords):
        response = general_responses.get('en', general_responses['en'])
        return translate_output(response, user_lang)
    
    # Default response
    default_response = "Hello! I'm DisastraBot. Ask me about earthquake, flood, fire, or cyclone safety. Type 'help' for more options."
    return translate_output(default_response, user_lang)